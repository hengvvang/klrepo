# Linux æ–‡ä»¶ç³»ç»Ÿç®¡ç†

## ğŸ“ æ¨¡å—æ¦‚è¿°

Linuxæ–‡ä»¶ç³»ç»Ÿç®¡ç†æ˜¯ç³»ç»Ÿç®¡ç†çš„åŸºç¡€æŠ€èƒ½ï¼Œæ¶µç›–æ–‡ä»¶ç³»ç»Ÿç±»å‹ã€ç£ç›˜åˆ†åŒºã€æŒ‚è½½ç®¡ç†ã€æƒé™æ§åˆ¶ç­‰æ ¸å¿ƒå†…å®¹ã€‚æœ¬æ¨¡å—åŸºäºLinuxå®˜æ–¹æ–‡æ¡£å’Œæ–‡ä»¶ç³»ç»Ÿæ ‡å‡†ç¼–å†™ã€‚

## ğŸ“š æ ¸å¿ƒå†…å®¹

### ğŸ’¾ [æ–‡ä»¶ç³»ç»ŸåŸºç¡€](filesystem-basics.md)
- **æ–‡ä»¶ç³»ç»Ÿæ¦‚å¿µ** - VFSã€Inodeã€ç›®å½•æ ‘ç»“æ„
- **å¸¸ç”¨æ–‡ä»¶ç³»ç»Ÿ** - ext4ã€XFSã€Btrfsç‰¹æ€§å¯¹æ¯”
- **æ–‡ä»¶ç³»ç»Ÿå±‚æ¬¡æ ‡å‡†** - FHSæ ‡å‡†ç›®å½•ç»“æ„
- **ç‰¹æ®Šæ–‡ä»¶ç³»ç»Ÿ** - procã€sysã€devç­‰è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ

### ğŸ”§ [ç£ç›˜åˆ†åŒºç®¡ç†](disk-partitioning.md)
- **åˆ†åŒºæ–¹æ¡ˆ** - MBRã€GPTåˆ†åŒºè¡¨å¯¹æ¯”
- **åˆ†åŒºå·¥å…·** - fdiskã€partedã€cfdiskä½¿ç”¨
- **LVMç®¡ç†** - é€»è¾‘å·ç®¡ç†å’ŒåŠ¨æ€æ‰©å®¹
- **RAIDé…ç½®** - è½¯ä»¶RAIDé…ç½®å’Œç®¡ç†

### ğŸ”— [æŒ‚è½½ä¸è‡ªåŠ¨æŒ‚è½½](mounting.md)
- **æŒ‚è½½åŸºç¡€** - mountå‘½ä»¤å’ŒæŒ‚è½½ç‚¹
- **fstabé…ç½®** - ç³»ç»Ÿå¯åŠ¨è‡ªåŠ¨æŒ‚è½½
- **ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿ** - NFSã€CIFS/SMBæŒ‚è½½
- **USBå’Œç§»åŠ¨è®¾å¤‡** - å¯ç§»åŠ¨è®¾å¤‡ç®¡ç†

### ğŸ” [æ–‡ä»¶æƒé™ä¸ACL](permissions-acl.md)
- **æ ‡å‡†æƒé™** - rwxæƒé™æ¨¡å‹å’Œå…«è¿›åˆ¶è¡¨ç¤º
- **ç‰¹æ®Šæƒé™** - SUIDã€SGIDã€Sticky Bit
- **æ‰©å±•å±æ€§** - æ–‡ä»¶å±æ€§å’Œæ‰©å±•æƒé™
- **è®¿é—®æ§åˆ¶åˆ—è¡¨** - ACLé«˜çº§æƒé™ç®¡ç†

### ğŸ“Š [å­˜å‚¨ç›‘æ§ä¸ç»´æŠ¤](storage-monitoring.md)
- **ç£ç›˜ä½¿ç”¨ç›‘æ§** - dfã€duå‘½ä»¤å’Œç©ºé—´åˆ†æ
- **æ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥** - fsckå·¥å…·å’Œé”™è¯¯ä¿®å¤
- **æ€§èƒ½ç›‘æ§** - iostatã€iotopå­˜å‚¨æ€§èƒ½åˆ†æ
- **ç»´æŠ¤å·¥å…·** - æ–‡ä»¶ç³»ç»Ÿä¼˜åŒ–å’Œç¢ç‰‡æ•´ç†

### ğŸ”„ [å¤‡ä»½ä¸åŒæ­¥](backup-sync.md)
- **å¤‡ä»½ç­–ç•¥** - å®Œæ•´å¤‡ä»½ã€å¢é‡å¤‡ä»½ã€é•œåƒå¤‡ä»½
- **åŒæ­¥å·¥å…·** - rsyncé«˜æ•ˆæ•°æ®åŒæ­¥
- **å¿«ç…§æŠ€æœ¯** - LVMã€Btrfså¿«ç…§åŠŸèƒ½
- **å½’æ¡£å·¥å…·** - tarã€cpioç­‰å½’æ¡£æ ¼å¼

## ğŸ—ï¸ æ–‡ä»¶ç³»ç»Ÿæ¶æ„

### Linuxæ–‡ä»¶ç³»ç»Ÿæ ˆ
```mermaid
graph TB
    A[åº”ç”¨ç¨‹åº] --> B[Cåº“/ç³»ç»Ÿè°ƒç”¨]
    B --> C[è™šæ‹Ÿæ–‡ä»¶ç³»ç»ŸVFS]
    C --> D[å…·ä½“æ–‡ä»¶ç³»ç»Ÿ]
    C --> E[ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿ]
    C --> F[ç‰¹æ®Šæ–‡ä»¶ç³»ç»Ÿ]
    
    D --> G[ext4]
    D --> H[XFS]
    D --> I[Btrfs]
    
    E --> J[NFS]
    E --> K[CIFS]
    
    F --> L[proc]
    F --> M[sys]
    F --> N[dev]
    
    G --> O[å—è®¾å¤‡å±‚]
    H --> O
    I --> O
    
    O --> P[è®¾å¤‡é©±åŠ¨]
    P --> Q[ç¡¬ä»¶è®¾å¤‡]
```

### ç›®å½•ç»“æ„æ ‡å‡†ï¼ˆFHSï¼‰
```bash
# æŸ¥çœ‹æ ¹ç›®å½•ç»“æ„
ls -la /

# æ ‡å‡†ç›®å½•è¯´æ˜
/bin        # åŸºæœ¬ç”¨æˆ·å‘½ä»¤
/sbin       # ç³»ç»Ÿç®¡ç†å‘½ä»¤
/etc        # é…ç½®æ–‡ä»¶
/var        # å¯å˜æ•°æ®
/tmp        # ä¸´æ—¶æ–‡ä»¶
/usr        # ç”¨æˆ·ç¨‹åº
/home       # ç”¨æˆ·ä¸»ç›®å½•
/root       # rootç”¨æˆ·ä¸»ç›®å½•
/lib        # å…±äº«åº“
/dev        # è®¾å¤‡æ–‡ä»¶
/proc       # è¿›ç¨‹ä¿¡æ¯
/sys        # ç³»ç»Ÿä¿¡æ¯
```

## ğŸ”§ æ ¸å¿ƒå·¥å…·å‘½ä»¤

### æ–‡ä»¶ç³»ç»Ÿç®¡ç†
```bash
# æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯
df -h           # ç£ç›˜ä½¿ç”¨æƒ…å†µ
du -sh *        # ç›®å½•å¤§å°ç»Ÿè®¡
lsblk           # å—è®¾å¤‡æ ‘å½¢æ˜¾ç¤º
findmnt         # æŒ‚è½½ç‚¹ä¿¡æ¯

# æ–‡ä»¶ç³»ç»Ÿæ“ä½œ
mkfs.ext4       # åˆ›å»ºext4æ–‡ä»¶ç³»ç»Ÿ
mkfs.xfs        # åˆ›å»ºXFSæ–‡ä»¶ç³»ç»Ÿ
tune2fs         # è°ƒæ•´ext2/3/4å‚æ•°
xfs_admin       # XFSç®¡ç†å·¥å…·
```

### ç£ç›˜åˆ†åŒºå·¥å…·
```bash
# åˆ†åŒºæ“ä½œ
fdisk           # MBRåˆ†åŒºå·¥å…·
gdisk           # GPTåˆ†åŒºå·¥å…·
parted          # é€šç”¨åˆ†åŒºå·¥å…·
cfdisk          # èœå•å¼åˆ†åŒºå·¥å…·

# LVMç®¡ç†
pvcreate        # åˆ›å»ºç‰©ç†å·
vgcreate        # åˆ›å»ºå·ç»„
lvcreate        # åˆ›å»ºé€»è¾‘å·
lvextend        # æ‰©å±•é€»è¾‘å·
```

### æƒé™ç®¡ç†å·¥å…·
```bash
# æƒé™æ“ä½œ
chmod           # ä¿®æ”¹æ–‡ä»¶æƒé™
chown           # ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€…
chgrp           # ä¿®æ”¹æ–‡ä»¶ç»„
umask           # é»˜è®¤æƒé™æ©ç 

# ACLç®¡ç†
setfacl         # è®¾ç½®ACL
getfacl         # æŸ¥çœ‹ACL
```

## ğŸ“‹ ç®¡ç†æ£€æŸ¥æ¸…å•

### æ—¥å¸¸ç›‘æ§ä»»åŠ¡
- [ ] æ£€æŸ¥ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µ
- [ ] ç›‘æ§æ–‡ä»¶ç³»ç»Ÿé”™è¯¯å’Œè­¦å‘Š
- [ ] éªŒè¯æŒ‚è½½ç‚¹çŠ¶æ€
- [ ] æ£€æŸ¥æƒé™è®¾ç½®åˆè§„æ€§
- [ ] æ¸…ç†ä¸´æ—¶æ–‡ä»¶å’Œæ—¥å¿—
- [ ] ç›‘æ§ç£ç›˜I/Oæ€§èƒ½
- [ ] æ£€æŸ¥å¤‡ä»½ä»»åŠ¡çŠ¶æ€
- [ ] å®¡æŸ¥æ–‡ä»¶è®¿é—®æ—¥å¿—

### ç»´æŠ¤ä»»åŠ¡
- [ ] æ–‡ä»¶ç³»ç»Ÿä¸€è‡´æ€§æ£€æŸ¥
- [ ] ç£ç›˜ç¢ç‰‡æ•´ç†ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] æƒé™å®¡è®¡å’Œæ¸…ç†
- [ ] å¤‡ä»½éªŒè¯å’Œæ¢å¤æµ‹è¯•
- [ ] å­˜å‚¨å®¹é‡è§„åˆ’
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•
- [ ] é…ç½®æ–‡ä»¶æ›´æ–°
- [ ] æ–‡æ¡£æ›´æ–°ç»´æŠ¤

## ğŸ¯ æœ€ä½³å®è·µ

### 1. åˆ†åŒºè§„åˆ’ç­–ç•¥
```bash
# æ¨èåˆ†åŒºæ–¹æ¡ˆï¼ˆæœåŠ¡å™¨ï¼‰
/boot       # 500MB-1GBï¼Œå¯åŠ¨åˆ†åŒº
/           # 20-50GBï¼Œæ ¹åˆ†åŒº
/usr        # 10-30GBï¼Œç”¨æˆ·ç¨‹åº
/var        # æ ¹æ®éœ€æ±‚ï¼Œæ—¥å¿—å’Œæ•°æ®
/home       # ç”¨æˆ·æ•°æ®åˆ†åŒº
/tmp        # 2-5GBï¼Œä¸´æ—¶æ–‡ä»¶
swap        # å†…å­˜1-2å€æˆ–æ ¹æ®éœ€æ±‚
```

### 2. æ–‡ä»¶ç³»ç»Ÿé€‰æ‹©æŒ‡å—
| ç”¨é€” | æ¨èæ–‡ä»¶ç³»ç»Ÿ | åŸå›  |
|------|-------------|------|
| æ ¹åˆ†åŒº | ext4 | ç¨³å®šå¯é ï¼Œå¹¿æ³›æ”¯æŒ |
| å¤§æ–‡ä»¶å­˜å‚¨ | XFS | é«˜æ€§èƒ½ï¼Œæ”¯æŒå¤§æ–‡ä»¶ |
| æ•°æ®åº“ | XFSæˆ–ext4 | æ€§èƒ½ä¼˜åŒ–ï¼Œæ”¯æŒextent |
| å¤‡ä»½å­˜å‚¨ | Btrfs | å¿«ç…§åŠŸèƒ½ï¼Œæ•°æ®æ ¡éªŒ |
| ä¸´æ—¶æ–‡ä»¶ | tmpfs | å†…å­˜æ–‡ä»¶ç³»ç»Ÿï¼Œé«˜é€Ÿ |

### 3. æƒé™ç®¡ç†åŸåˆ™
```bash
# æœ€å°æƒé™åŸåˆ™
# ç›®å½•æƒé™ï¼š755 (rwxr-xr-x)
# é…ç½®æ–‡ä»¶ï¼š644 (rw-r--r--)
# æ‰§è¡Œæ–‡ä»¶ï¼š755 (rwxr-xr-x)
# æ•æ„Ÿæ–‡ä»¶ï¼š600 (rw-------)

# ç¤ºä¾‹ï¼šWebæœåŠ¡å™¨æƒé™
chown -R www-data:www-data /var/www/html/
find /var/www/html/ -type d -exec chmod 755 {} \;
find /var/www/html/ -type f -exec chmod 644 {} \;
```

### 4. æŒ‚è½½é€‰é¡¹ä¼˜åŒ–
```bash
# /etc/fstabä¼˜åŒ–é…ç½®ç¤ºä¾‹
UUID=xxx / ext4 defaults,noatime,errors=remount-ro 0 1
UUID=yyy /var xfs defaults,noatime,largeio,inode64 0 2
tmpfs /tmp tmpfs defaults,noatime,mode=1777,size=2G 0 0

# å¸¸ç”¨æŒ‚è½½é€‰é¡¹
noatime     # ä¸æ›´æ–°è®¿é—®æ—¶é—´ï¼Œæé«˜æ€§èƒ½
nodev       # ä¸è§£æè®¾å¤‡æ–‡ä»¶ï¼Œå®‰å…¨æ€§
nosuid      # ä¸å…è®¸SUID/SGIDï¼Œå®‰å…¨æ€§
ro          # åªè¯»æŒ‚è½½
rw          # è¯»å†™æŒ‚è½½
```

## ğŸ” æ•…éšœæ’é™¤æŒ‡å—

### å¸¸è§é—®é¢˜è¯Šæ–­

#### 1. ç£ç›˜ç©ºé—´ä¸è¶³
```bash
# å¿«é€Ÿå®šä½å¤§æ–‡ä»¶
du -sh /* | sort -hr | head -20

# æŸ¥æ‰¾å¤§æ–‡ä»¶
find / -type f -size +100M -exec ls -lh {} \; 2>/dev/null

# æ¸…ç†ç³»ç»Ÿåƒåœ¾
apt autoremove && apt autoclean  # Debian/Ubuntu
dnf autoremove && dnf clean all  # Fedora/RHEL

# æ¸…ç†æ—¥å¿—æ–‡ä»¶
journalctl --vacuum-time=7d
rm -f /var/log/*.log.1 /var/log/*.log.*.gz
```

#### 2. æ–‡ä»¶ç³»ç»Ÿé”™è¯¯
```bash
# æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿ
fsck -f /dev/sdb1  # å¼ºåˆ¶æ£€æŸ¥
fsck -y /dev/sdb1  # è‡ªåŠ¨ä¿®å¤

# åªè¯»æ¨¡å¼ä¿®å¤
mount -o remount,ro /
fsck -f /dev/sda1
mount -o remount,rw /
```

#### 3. æŒ‚è½½é—®é¢˜
```bash
# æŸ¥çœ‹æŒ‚è½½çŠ¶æ€
mount | grep /target/mount/point
findmnt /target/mount/point

# å¼ºåˆ¶å¸è½½
umount -f /target/mount/point
fuser -km /target/mount/point  # ç»ˆæ­¢å ç”¨è¿›ç¨‹

# æ£€æŸ¥fstabè¯­æ³•
mount -fav  # æµ‹è¯•fstabé…ç½®
```

## ğŸ“Š æ€§èƒ½ç›‘æ§

### å­˜å‚¨æ€§èƒ½æŒ‡æ ‡
```bash
# I/Oç»Ÿè®¡
iostat -x 1        # æ‰©å±•I/Oç»Ÿè®¡
iotop -o           # å®æ—¶I/Oç›‘æ§
dstat -d           # ç£ç›˜ç»Ÿè®¡

# æ–‡ä»¶ç³»ç»Ÿæ€§èƒ½æµ‹è¯•
dd if=/dev/zero of=testfile bs=1G count=1 oflag=direct
hdparm -t /dev/sda  # ç£ç›˜è¯»å–æµ‹è¯•
bonnie++ -r 1024    # ç»¼åˆæ€§èƒ½æµ‹è¯•
```

### ç›‘æ§é˜ˆå€¼è®¾ç½®
| æŒ‡æ ‡ | è­¦å‘Šé˜ˆå€¼ | ä¸¥é‡é˜ˆå€¼ |
|------|----------|----------|
| ç£ç›˜ä½¿ç”¨ç‡ | 80% | 90% |
| Inodeä½¿ç”¨ç‡ | 80% | 90% |
| I/Oç­‰å¾…æ—¶é—´ | 20% | 40% |
| ç£ç›˜é˜Ÿåˆ—é•¿åº¦ | 5 | 10 |
| è¯»å†™é”™è¯¯æ•° | 1/å°æ—¶ | 5/å°æ—¶ |

## ğŸ” å®‰å…¨é…ç½®

### æ–‡ä»¶ç³»ç»Ÿå®‰å…¨
```bash
# è®¾ç½®noexecæŒ‚è½½é€‰é¡¹
/dev/sdb1 /tmp ext4 defaults,noexec,nosuid,nodev 0 2

# éšè—è¿›ç¨‹ä¿¡æ¯
mount -o remount,hidepid=2 /proc

# è®¾ç½®æ–‡ä»¶å±æ€§
chattr +i /etc/passwd     # è®¾ç½®ä¸å¯ä¿®æ”¹
lsattr /etc/passwd        # æŸ¥çœ‹æ–‡ä»¶å±æ€§
```

### æƒé™å®¡è®¡
```bash
# æŸ¥æ‰¾SUIDæ–‡ä»¶
find / -perm -4000 -type f 2>/dev/null

# æŸ¥æ‰¾å¯å†™æ–‡ä»¶
find / -perm -2 -type f 2>/dev/null

# æŸ¥æ‰¾æ— ä¸»æ–‡ä»¶
find / -nouser -o -nogroup 2>/dev/null
```

## ğŸ“š å­¦ä¹ èµ„æº

### å®˜æ–¹æ–‡æ¡£
- [Linuxæ–‡ä»¶ç³»ç»Ÿæ–‡æ¡£](https://www.kernel.org/doc/html/latest/filesystems/)
- [ext4æ–‡ä»¶ç³»ç»Ÿ](https://ext4.wiki.kernel.org/)
- [XFSæ–‡æ¡£](https://xfs.wiki.kernel.org/)
- [Btrfsæ–‡æ¡£](https://btrfs.wiki.kernel.org/)

### æ ‡å‡†æ–‡æ¡£
- [æ–‡ä»¶ç³»ç»Ÿå±‚æ¬¡æ ‡å‡†(FHS)](https://refspecs.linuxfoundation.org/fhs.shtml)
- [Linuxæ ‡å‡†åŸºç¡€(LSB)](https://refspecs.linuxfoundation.org/lsb.shtml)

### å®ç”¨æŒ‡å—
- [æ–‡ä»¶ç³»ç»Ÿæ€§èƒ½è°ƒä¼˜æŒ‡å—](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/managing_file_systems/)
- [å­˜å‚¨ç®¡ç†æœ€ä½³å®è·µ](https://ubuntu.com/server/docs/device-mapper-multipathing-introduction)

## ğŸš€ å®è·µå»ºè®®

### ç¯å¢ƒå‡†å¤‡
1. **è™šæ‹Ÿæœºç¯å¢ƒ** - ä½¿ç”¨å¤šä¸ªè™šæ‹Ÿç£ç›˜ç»ƒä¹ 
2. **å®¹å™¨ç¯å¢ƒ** - ç»ƒä¹ å®¹å™¨å­˜å‚¨ç®¡ç†
3. **äº‘ç¯å¢ƒ** - ä½“éªŒäº‘å­˜å‚¨æœåŠ¡

### å®è·µé¡¹ç›®
1. **å¤šç”¨æˆ·æ–‡ä»¶æœåŠ¡å™¨** - é…ç½®å…±äº«å­˜å‚¨å’Œæƒé™
2. **æ•°æ®åº“å­˜å‚¨ä¼˜åŒ–** - é’ˆå¯¹æ•°æ®åº“çš„å­˜å‚¨é…ç½®
3. **å¤‡ä»½ç³»ç»Ÿæ­å»º** - å®Œæ•´çš„å¤‡ä»½æ¢å¤æ–¹æ¡ˆ
4. **é«˜å¯ç”¨å­˜å‚¨** - RAIDå’ŒLVMé«˜å¯ç”¨é…ç½®

---

*å¼€å§‹æ‚¨çš„æ–‡ä»¶ç³»ç»Ÿç®¡ç†å­¦ä¹ ä¹‹è·¯ï¼š[æ–‡ä»¶ç³»ç»ŸåŸºç¡€](filesystem-basics.md)*
